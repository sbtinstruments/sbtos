-- name: create-tables#
CREATE TABLE IF NOT EXISTS variable (
    name           TEXT     PRIMARY KEY,
    value          BLOB     NOT NULL,
    created_on     DATETIME NOT NULL DEFAULT (CAST(strftime('%s','now') as INTEGER)),
    last_modified  DATETIME NOT NULL,
                    /* FPA: I don't think that these type constraints have any 
                     * effect in newer versions of sqlite.
                     *
                     * Let's keep them for now. They don't do any harm.
                     *
                     * See: https://sqlite.org/src/info/86ba67afafded936
                     */
                    CONSTRAINT ck_variable_created_on_is_int
                    CHECK (typeof(created_on) == 'integer'),
                    CONSTRAINT ck_variable_last_modified_is_int
                    CHECK (typeof(last_modified) == 'integer'));
                    /* FPA: I think that there is a bug with the following constraint
                     * in combination with "upserts" (ON CONFLICT DO UPDATE).
                     * Occurs on: arm-linux-gnueabihf with sqlite 2020-08-14 (3.33.0)
                     *
                     * We simply disable this constraint for now.
                     */
                    -- CONSTRAINT ck_variable_modified_geq_created
                    -- CHECK (last_modified >= created_on));