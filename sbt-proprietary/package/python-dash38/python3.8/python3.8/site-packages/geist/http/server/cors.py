"""Cross-origin resource sharing (CORS) utilies for aiohttp."""
from aiohttp import web as _web
from multidict import MultiDict as _MultiDict


_ORIGIN = '*'


@_web.middleware
async def cors_middleware(request, handler):
	"""Middleware that enables requests from all origins."""
	if 'OPTIONS' == request.method:
		return _web.Response(headers=_MultiDict({
			'Access-Control-Allow-Origin': _ORIGIN,
			'Access-Control-Allow-Methods': request.headers.get('Access-Control-Request-Method', ''),
			'Access-Control-Allow-Headers': request.headers.get('Access-Control-Request-Headers', ''),
			'Access-Control-Max-Age': '1728000',
		}))
	return await handler(request)


async def cors_signal(request, response):
	"""Signal that enables requests from all origins."""
	response.headers['Access-Control-Allow-Origin'] = _ORIGIN
