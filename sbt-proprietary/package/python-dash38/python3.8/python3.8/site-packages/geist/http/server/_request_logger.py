"""Log HTTP requests."""
import logging


class RequestLogger(logging.LoggerAdapter):
	"""Add HTTP request-specific information to the log entry."""

	def __init__(self, logger, request):
		"""Construct request logger from the given logger and request."""
		super().__init__(logger, {})
		self._request = request

	def process(self, msg, kwargs):
		"""Override the default log message processing."""
		if self._request.transport is not None:
			peername = self._request.transport.get_extra_info('peername')
			peername = '{}:{}'.format(*peername)
		else:
			peername = '<unknown-peer>'
		path = self._request.path
		return f'{peername} Websocket "{path}" {msg}', kwargs
