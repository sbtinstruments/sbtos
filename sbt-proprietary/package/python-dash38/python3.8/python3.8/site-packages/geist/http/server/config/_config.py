"""Aiohttp application for everything config related."""
from weakref import WeakSet
from aiohttp import web
from ._config_handler import ConfigHandler
from ..ws import close_websockets


def config_app(config):
	"""Return an aiohttp Application that exposes an interface to the given config."""
	app = web.Application()
	app['websockets'] = WeakSet()
	app['config'] = config
	app['config_handler'] = ConfigHandler(app)
	app.on_shutdown.append(close_websockets)
	config_handler = app['config_handler']
	app.router.add_get('', config_handler.get_config)
	app.router.add_patch('', config_handler.patch_config)
	return app
