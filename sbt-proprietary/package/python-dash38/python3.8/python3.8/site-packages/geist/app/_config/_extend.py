"""Functions to extend jsonschema validators."""
from jsonschema import validators


# Reference: https://python-jsonschema.readthedocs.io/en/latest/faq/#why-doesn-t-my-schema-s-default-property-set-the-default-on-my-instance # noqa: 501 # pylint: disable=line-too-long
def extend_with_default(validator_class):
	"""Set the 'default' value if defined in the schema."""
	validate_properties = validator_class.VALIDATORS['properties']

	def _set_defaults(validator, properties, instance, schema):
		for property_, subschema in properties.items():
			if 'default' in subschema:
				instance.setdefault(property_, subschema['default'])

		for error in validate_properties(validator, properties, instance, schema):
			yield error

	return validators.extend(validator_class, {'properties': _set_defaults})
