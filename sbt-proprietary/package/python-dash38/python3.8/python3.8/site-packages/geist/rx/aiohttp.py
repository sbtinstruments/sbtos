from rx.core.typing import Observable
from .asyncio import to_agen
from ..http.server.ws import WebSocketWriter


async def ws_stream(req, obs: Observable, *args, **kwargs):
	# If a name is given, suffix it with 'ws:'
	try:
		name = kwargs['name']
		kwargs['name'] = f"ws:{name}"
	# Otherwise, just set the name to 'ws'
	except KeyError:
		kwargs['name'] = 'ws'
	wsw = WebSocketWriter(req)
	with to_agen(obs, *args, **kwargs) as agen:
		return await wsw.handler(agen)
