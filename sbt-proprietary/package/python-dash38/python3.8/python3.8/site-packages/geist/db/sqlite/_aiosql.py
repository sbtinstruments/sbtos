import logging
from importlib import resources
from pathlib import Path

import aiosql

_LOGGER = logging.getLogger(__name__)


def get_package_queries(package: str, driver_adapter: str, record_classes=None) -> aiosql.queries.Queries:
	"""Return queries as defined in the SQL files of the given package"""
	contents = resources.contents(package)
	# Read all SQL files in this package
	sql_files = (Path(c) for c in contents if c.endswith(".sql"))
	sql_text = {
		sql_file.stem: resources.read_text(package, sql_file)
		for sql_file in sql_files
	}
	# Parse SQL files into query functions
	result = aiosql.queries.Queries(driver_adapter)
	for stem, sql in sql_text.items():
		child_queries = aiosql.from_str(sql, driver_adapter, record_classes)
		result.add_child_queries(stem, child_queries)
	return result
